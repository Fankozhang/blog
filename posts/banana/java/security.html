<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://github.com/Fankozhang/blog/posts/banana/java/security.html"><meta property="og:title" content="Spring Security"><meta property="og:description" content="SpringSecurityæ¡†æ¶æ•™ç¨‹-Spring Security+JWTå®ç°é¡¹ç›®çº§å‰ç«¯åˆ†ç¦»è®¤è¯æˆæƒ-æŒ‘æˆ˜é»‘é©¬&å°šç¡…è°·å“”å“©å“”å“©bilibili (https://www.bilibili.com/video/BV1mm4y1X7Hc/?spmidfrom=333.999.0.0&vd_source=f25f5a8d75a3a60d5a288f7268..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-10-30T01:28:23.000Z"><meta property="og:locale" content="en-US"><meta property="og:locale:alternate" content="zh-CN"><meta property="article:tag" content="java"><meta property="article:tag" content="security"><meta property="article:published_time" content="2022-01-05T00:00:00.000Z"><meta property="article:modified_time" content="2023-10-30T01:28:23.000Z"><link rel="alternate" hreflang="zh-cn" href="https://github.com/Fankozhang/blog/zh/posts/banana/java/security.html"><link rel="icon" href="/blog/favicon.ico"><link rel="icon" href="/blog/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/blog/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/blog/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/blog/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/blog/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/blog/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>Spring Security</title><meta name="description" content="SpringSecurityæ¡†æ¶æ•™ç¨‹-Spring Security+JWTå®ç°é¡¹ç›®çº§å‰ç«¯åˆ†ç¦»è®¤è¯æˆæƒ-æŒ‘æˆ˜é»‘é©¬&å°šç¡…è°·å“”å“©å“”å“©bilibili (https://www.bilibili.com/video/BV1mm4y1X7Hc/?spmidfrom=333.999.0.0&vd_source=f25f5a8d75a3a60d5a288f7268...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/blog/assets/style.93125887.css" as="style" /><link rel="stylesheet" href="/blog/assets/style.93125887.css" />
    <link rel="modulepreload" href="/blog/assets/app.a6537d53.js"><link rel="modulepreload" href="/blog/assets/security.html.22261940.js"><link rel="modulepreload" href="/blog/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/blog/assets/security.html.aa85d214.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/blog/" class="brand"><img class="logo" src="/blog/logo.png" alt><!----><!----></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link active" aria-label="é¦–é¡µ"><span class="icon iconfont icon-home"></span>é¦–é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å‰ç«¯"><span class="title"><span class="icon iconfont icon-note"></span>å‰ç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å‰ç«¯çŸ¥è¯†è®°å½•</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/posts/apple/1.html" class="nav-link" aria-label="html"><!---->html<!----></a></li><li class="dropdown-subitem"><a href="/blog/posts/apple/2.html" class="nav-link" aria-label="css"><!---->css<!----></a></li><li class="dropdown-subitem"><a href="/blog/posts/apple/3.html" class="nav-link" aria-label="javaScript"><!---->javaScript<!----></a></li><li class="dropdown-subitem"><a href="/blog/posts/apple/4.html" class="nav-link" aria-label="vue"><!---->vue<!----></a></li></ul></li><li class="dropdown-item"><a href="/blog/posts/cherry.html" class="nav-link" aria-label="vuePress,nginx,docker"><!---->vuePress,nginx,docker<!----></a></li><li class="dropdown-item"><a href="/blog/posts/dragonfruit.html" class="nav-link" aria-label="uni-app"><!---->uni-app<!----></a></li><li class="dropdown-item"><a href="/blog/posts/tomato.html" class="nav-link" aria-label="react"><!---->react<!----></a></li><li class="dropdown-item"><a href="/blog/posts/strawberry.html" class="nav-link" aria-label="UI and Data"><!---->UI and Data<!----></a></li><li class="dropdown-item"><a href="/blog/posts/bigScreen.html" class="nav-link" aria-label="bigScreen"><!---->bigScreen<!----></a></li><li class="dropdown-item"><a href="/blog/posts/desk.html" class="nav-link" aria-label="çŸ¥è¯†æ‹“å±•(electron,qiankun)"><!---->çŸ¥è¯†æ‹“å±•(electron,qiankun)<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åç«¯"><span class="title"><span class="icon iconfont icon-note"></span>åç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>javaç›¸å…³æŠ€æœ¯</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/posts/banana/java/basic.html" class="nav-link" aria-label="javaåŸºç¡€"><!---->javaåŸºç¡€<!----></a></li><li class="dropdown-subitem"><a href="/blog/posts/banana/java/spring-boot.html" class="nav-link" aria-label="springBoot"><!---->springBoot<!----></a></li><li class="dropdown-subitem"><a href="/blog/posts/banana/java/shiro.html" class="nav-link" aria-label="shiro"><!---->shiro<!----></a></li><li class="dropdown-subitem"><a aria-current="page" href="/blog/posts/banana/java/security.html" class="router-link-active router-link-exact-active nav-link active" aria-label="security"><!---->security<!----></a></li><li class="dropdown-subitem"><a href="/blog/posts/banana/java/1.html" class="nav-link" aria-label="spring cloud"><!---->spring cloud<!----></a></li></ul></li><li class="dropdown-item"><a href="/blog/posts/banana/2.html" class="nav-link" aria-label="node"><!---->node<!----></a></li><li class="dropdown-item"><a href="/blog/posts/banana/spring.html" class="nav-link" aria-label="å®æˆ˜é¡¹ç›®"><!---->å®æˆ˜é¡¹ç›®<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ”¶è—"><span class="title"><!---->æ”¶è—</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/blog/site/site1.html" class="nav-link" aria-label="ç½‘å€æ”¶è—"><span class="icon iconfont icon-edit"></span>ç½‘å€æ”¶è—<!----></a></li><li class="dropdown-item"><a href="/blog/site/method.html" class="nav-link" aria-label="å·¥ä½œä¸­é—®é¢˜åŠè§£å†³"><span class="icon iconfont icon-edit"></span>å·¥ä½œä¸­é—®é¢˜åŠè§£å†³<!----></a></li><li class="dropdown-item"><a href="/blog/site/python.html" class="nav-link" aria-label="python"><span class="icon iconfont icon-edit"></span>python<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://github.com/Fankozhang" rel="noopener noreferrer" target="_blank" aria-label="github" class="nav-link"><span class="icon iconfont icon-note"></span>github<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/blog/" class="nav-link sidebar-link sidebar-page" aria-label="é¦–é¡µ"><span class="icon iconfont icon-home"></span>é¦–é¡µ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-note"></span><span class="title">å‰ç«¯</span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">å‰ç«¯çŸ¥è¯†è®°å½•</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/blog/posts/apple/1.html" class="nav-link sidebar-link sidebar-page" aria-label="html"><!---->html<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/apple/2.html" class="nav-link sidebar-link sidebar-page" aria-label="css"><!---->css<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/apple/3.html" class="nav-link sidebar-link sidebar-page" aria-label="javaScript"><!---->javaScript<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/apple/4.html" class="nav-link sidebar-link sidebar-page" aria-label="vue"><!---->vue<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/blog/posts/cherry.html" class="nav-link sidebar-link sidebar-page" aria-label="vuePress,nginx,docker"><!---->vuePress,nginx,docker<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/dragonfruit.html" class="nav-link sidebar-link sidebar-page" aria-label="uni-app"><!---->uni-app<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/tomato.html" class="nav-link sidebar-link sidebar-page" aria-label="react"><!---->react<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/strawberry.html" class="nav-link sidebar-link sidebar-page" aria-label="UI and Data"><!---->UI and Data<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/bigScreen.html" class="nav-link sidebar-link sidebar-page" aria-label="bigScreen"><!---->bigScreen<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/desk.html" class="nav-link sidebar-link sidebar-page" aria-label="çŸ¥è¯†æ‹“å±•(electron,qiankun)"><!---->çŸ¥è¯†æ‹“å±•(electron,qiankun)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading active"><span class="icon iconfont icon-note"></span><span class="title">åç«¯</span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading active"><!----><span class="title">javaç›¸å…³æŠ€æœ¯</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/blog/posts/banana/java/basic.html" class="nav-link sidebar-link sidebar-page" aria-label="javaåŸºç¡€"><!---->javaåŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/banana/java/spring-boot.html" class="nav-link sidebar-link sidebar-page" aria-label="springBoot"><!---->springBoot<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/banana/java/shiro.html" class="nav-link sidebar-link sidebar-page" aria-label="shiro"><!---->shiro<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/blog/posts/banana/java/security.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="security"><!---->security<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#ä¾èµ–-application-yml" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¾èµ–,  application.yml"><!---->ä¾èµ–,  application.yml<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#ç™»å½•éªŒè¯æµç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç™»å½•éªŒè¯æµç¨‹"><!---->ç™»å½•éªŒè¯æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#æ€è·¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ€è·¯"><!---->æ€è·¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è¡¨è®¾è®¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è¡¨è®¾è®¡"><!---->è¡¨è®¾è®¡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è¿”å›ç»“æœç±»å‹result" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è¿”å›ç»“æœç±»å‹Result"><!---->è¿”å›ç»“æœç±»å‹Result<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#redisé…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisé…ç½®"><!---->Redisé…ç½®<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#redisconfig" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="RedisConfig"><!---->RedisConfig<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#rediscache-å·¥å…·ç±»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="RedisCache(å·¥å…·ç±»)"><!---->RedisCache(å·¥å…·ç±»)<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#å®ä½“ç±»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®ä½“ç±»"><!---->å®ä½“ç±»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#user" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="User"><!---->User<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#loginuser-securityç™»é™†æ—¶ä½¿ç”¨åˆ°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="LoginUser  (securityç™»é™†æ—¶ä½¿ç”¨åˆ°)"><!---->LoginUser  (securityç™»é™†æ—¶ä½¿ç”¨åˆ°)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#permission" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="permission"><!---->permission<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#é‡å†™-userdetailservice-securityåŒ…é‡Œçš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é‡å†™ UserDetailService  (securityåŒ…é‡Œçš„)"><!---->é‡å†™ UserDetailService  (securityåŒ…é‡Œçš„)<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#userdetailsservice" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="UserDetailsService"><!---->UserDetailsService<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#userdetailsserviceimpl" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="UserDetailsServiceImpl"><!---->UserDetailsServiceImpl<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#ä½¿ç”¨scurityç™»å½•é¡µç™»å½•-æ•°æ®åº“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä½¿ç”¨Scurityç™»å½•é¡µç™»å½•ï¼ˆæ•°æ®åº“ï¼‰"><!---->ä½¿ç”¨Scurityç™»å½•é¡µç™»å½•ï¼ˆæ•°æ®åº“ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#å¯†ç åŠ å¯†å­˜å‚¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¯†ç åŠ å¯†å­˜å‚¨"><!---->å¯†ç åŠ å¯†å­˜å‚¨<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#securityconfig" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SecurityConfig"><!---->SecurityConfig<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#passwordencoderæµ‹è¯•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="passwordEncoderæµ‹è¯•"><!---->passwordEncoderæµ‹è¯•<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#é¡µé¢æµ‹è¯•-è´¦å·-å¯†ç ç™»å½•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é¡µé¢æµ‹è¯•ï¼ˆè´¦å·ï¼Œå¯†ç ç™»å½•ï¼‰"><!---->é¡µé¢æµ‹è¯•ï¼ˆè´¦å·ï¼Œå¯†ç ç™»å½•ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#jwt" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="JWT"><!---->JWT<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#jwtå·¥å…·ç±»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="jwtå·¥å…·ç±»"><!---->jwtå·¥å…·ç±»<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰ç™»å½•æ¥å£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è‡ªå®šä¹‰ç™»å½•æ¥å£"><!---->è‡ªå®šä¹‰ç™»å½•æ¥å£<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰ç™»å½•æ¥å£-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è‡ªå®šä¹‰ç™»å½•æ¥å£"><!---->è‡ªå®šä¹‰ç™»å½•æ¥å£<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#securityconfigä¸­é‡å†™-authenticationmanager" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SecurityConfigä¸­é‡å†™ AuthenticationManager"><!---->SecurityConfigä¸­é‡å†™ AuthenticationManager<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#logincontroller" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="LoginController"><!---->LoginController<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#loginservice" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="LoginService"><!---->LoginService<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#loginserviceimpl" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="LoginServiceImpl"><!---->LoginServiceImpl<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#å®šä¹‰jwtè®¤è¯è¿‡æ»¤å™¨-token-è§£æè¿‡æ»¤å™¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨(Token è§£æè¿‡æ»¤å™¨)"><!---->å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨(Token è§£æè¿‡æ»¤å™¨)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#é…ç½®è¿‡æ»¤å™¨é“¾" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é…ç½®è¿‡æ»¤å™¨é“¾"><!---->é…ç½®è¿‡æ»¤å™¨é“¾<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#é€€å‡ºç™»å½•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é€€å‡ºç™»å½•"><!---->é€€å‡ºç™»å½•<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#æˆæƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æˆæƒ"><!---->æˆæƒ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#æˆæƒåŸºæœ¬æµç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æˆæƒåŸºæœ¬æµç¨‹"><!---->æˆæƒåŸºæœ¬æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#æˆæƒå®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æˆæƒå®ç°"><!---->æˆæƒå®ç°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#å°è£…æƒé™ä¿¡æ¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å°è£…æƒé™ä¿¡æ¯"><!---->å°è£…æƒé™ä¿¡æ¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#sql-æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢æƒé™" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="sql(æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢æƒé™)"><!---->sql(æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢æƒé™)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#ä»£ç å®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»£ç å®ç°"><!---->ä»£ç å®ç°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#æµ‹è¯•-redisåºåˆ—åŒ–æŠ¥é”™-å°šæœªè§£å†³" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æµ‹è¯•ï¼šredisåºåˆ—åŒ–æŠ¥é”™ï¼Œå°šæœªè§£å†³"><!---->æµ‹è¯•ï¼šredisåºåˆ—åŒ–æŠ¥é”™ï¼Œå°šæœªè§£å†³<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨"><!---->è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è·¨åŸŸ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è·¨åŸŸ"><!---->è·¨åŸŸ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#æ‹¦æˆªå™¨æ–¹å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ‹¦æˆªå™¨æ–¹å¼"><!---->æ‹¦æˆªå™¨æ–¹å¼<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•"><!---->è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰è®¤è¯æˆåŠŸå¤„ç†å™¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è‡ªå®šä¹‰è®¤è¯æˆåŠŸå¤„ç†å™¨"><!---->è‡ªå®šä¹‰è®¤è¯æˆåŠŸå¤„ç†å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨"><!---->è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#æ³¨é”€æˆåŠŸå¤„ç†å™¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ³¨é”€æˆåŠŸå¤„ç†å™¨"><!---->æ³¨é”€æˆåŠŸå¤„ç†å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#oauth2-0" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="OAuth2.0"><!---->OAuth2.0<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#è§’è‰²-åº”ç”¨ã€apiå’Œç”¨æˆ·" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è§’è‰²ï¼šåº”ç”¨ã€apiå’Œç”¨æˆ·"><!---->è§’è‰²ï¼šåº”ç”¨ã€apiå’Œç”¨æˆ·<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#å››ç§æˆæƒæ¨¡å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å››ç§æˆæƒæ¨¡å¼"><!---->å››ç§æˆæƒæ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#ç†è®ºåŸºç¡€-javaç”ŸæˆäºŒç»´ç " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç†è®ºåŸºç¡€-javaç”ŸæˆäºŒç»´ç "><!---->ç†è®ºåŸºç¡€-javaç”ŸæˆäºŒç»´ç <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/posts/banana/java/security.html#å¾®ä¿¡æ‰«ç ç™»å½•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¾®ä¿¡æ‰«ç ç™»å½•"><!---->å¾®ä¿¡æ‰«ç ç™»å½•<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/blog/posts/banana/java/1.html" class="nav-link sidebar-link sidebar-page" aria-label="spring cloud"><!---->spring cloud<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/blog/posts/banana/2.html" class="nav-link sidebar-link sidebar-page" aria-label="node"><!---->node<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/posts/banana/spring.html" class="nav-link sidebar-link sidebar-page" aria-label="å®æˆ˜é¡¹ç›®"><!---->å®æˆ˜é¡¹ç›®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">æ”¶è—</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/blog/site/site1.html" class="nav-link sidebar-link sidebar-page" aria-label="ç½‘å€æ”¶è—"><!---->ç½‘å€æ”¶è—<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/site/method.html" class="nav-link sidebar-link sidebar-page" aria-label="å·¥ä½œä¸­é—®é¢˜åŠè§£å†³"><!---->å·¥ä½œä¸­é—®é¢˜åŠè§£å†³<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/site/python.html" class="nav-link sidebar-link sidebar-page" aria-label="python"><!---->python<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/blog/intro.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸ªäººä»‹ç»"><span class="icon iconfont icon-info"></span>ä¸ªäººä»‹ç»<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/slides.html" class="nav-link sidebar-link sidebar-page" aria-label="Slide page"><span class="icon iconfont icon-slides"></span>Slide page<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-edit"></span>Spring Security</h1><div class="page-info"><span class="author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/Fankozhang" target="_blank" rel="noopener noreferrer">å¸†</a></span><span property="author" content="å¸†"></span></span><!----><span class="date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-01-05T00:00:00.000Z"></span><!----><span aria-label="TagğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag6 clickable" role="navigation">java</span></li><li><span class="tag tag2 clickable" role="navigation">security</span></li></ul><meta property="keywords" content="java,security"></span><span class="reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 22 min</span><meta property="timeRequired" content="PT22M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#ä¾èµ–-application-yml" class="router-link-active router-link-exact-active toc-link level2">ä¾èµ–,  application.yml</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#ç™»å½•éªŒè¯æµç¨‹" class="router-link-active router-link-exact-active toc-link level2">ç™»å½•éªŒè¯æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#æ€è·¯" class="router-link-active router-link-exact-active toc-link level2">æ€è·¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è¡¨è®¾è®¡" class="router-link-active router-link-exact-active toc-link level2">è¡¨è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è¿”å›ç»“æœç±»å‹result" class="router-link-active router-link-exact-active toc-link level2">è¿”å›ç»“æœç±»å‹Result</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#redisé…ç½®" class="router-link-active router-link-exact-active toc-link level2">Redisé…ç½®</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#redisconfig" class="router-link-active router-link-exact-active toc-link level3">RedisConfig</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#rediscache-å·¥å…·ç±»" class="router-link-active router-link-exact-active toc-link level3">RedisCache(å·¥å…·ç±»)</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#å®ä½“ç±»" class="router-link-active router-link-exact-active toc-link level2">å®ä½“ç±»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#user" class="router-link-active router-link-exact-active toc-link level3">User</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#loginuser-securityç™»é™†æ—¶ä½¿ç”¨åˆ°" class="router-link-active router-link-exact-active toc-link level3">LoginUser  (securityç™»é™†æ—¶ä½¿ç”¨åˆ°)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#permission" class="router-link-active router-link-exact-active toc-link level3">permission</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#é‡å†™-userdetailservice-securityåŒ…é‡Œçš„" class="router-link-active router-link-exact-active toc-link level2">é‡å†™ UserDetailService  (securityåŒ…é‡Œçš„)</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#userdetailsservice" class="router-link-active router-link-exact-active toc-link level3">UserDetailsService</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#userdetailsserviceimpl" class="router-link-active router-link-exact-active toc-link level3">UserDetailsServiceImpl</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#ä½¿ç”¨scurityç™»å½•é¡µç™»å½•-æ•°æ®åº“" class="router-link-active router-link-exact-active toc-link level2">ä½¿ç”¨Scurityç™»å½•é¡µç™»å½•ï¼ˆæ•°æ®åº“ï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#å¯†ç åŠ å¯†å­˜å‚¨" class="router-link-active router-link-exact-active toc-link level2">å¯†ç åŠ å¯†å­˜å‚¨</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#securityconfig" class="router-link-active router-link-exact-active toc-link level3">SecurityConfig</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#passwordencoderæµ‹è¯•" class="router-link-active router-link-exact-active toc-link level3">passwordEncoderæµ‹è¯•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#é¡µé¢æµ‹è¯•-è´¦å·-å¯†ç ç™»å½•" class="router-link-active router-link-exact-active toc-link level3">é¡µé¢æµ‹è¯•ï¼ˆè´¦å·ï¼Œå¯†ç ç™»å½•ï¼‰</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#jwt" class="router-link-active router-link-exact-active toc-link level2">JWT</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#jwtå·¥å…·ç±»" class="router-link-active router-link-exact-active toc-link level3">jwtå·¥å…·ç±»</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰ç™»å½•æ¥å£" class="router-link-active router-link-exact-active toc-link level2">è‡ªå®šä¹‰ç™»å½•æ¥å£</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰ç™»å½•æ¥å£-1" class="router-link-active router-link-exact-active toc-link level3">è‡ªå®šä¹‰ç™»å½•æ¥å£</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#securityconfigä¸­é‡å†™-authenticationmanager" class="router-link-active router-link-exact-active toc-link level3">SecurityConfigä¸­é‡å†™ AuthenticationManager</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#logincontroller" class="router-link-active router-link-exact-active toc-link level3">LoginController</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#loginservice" class="router-link-active router-link-exact-active toc-link level3">LoginService</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#loginserviceimpl" class="router-link-active router-link-exact-active toc-link level3">LoginServiceImpl</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#å®šä¹‰jwtè®¤è¯è¿‡æ»¤å™¨-token-è§£æè¿‡æ»¤å™¨" class="router-link-active router-link-exact-active toc-link level3">å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨(Token è§£æè¿‡æ»¤å™¨)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#é…ç½®è¿‡æ»¤å™¨é“¾" class="router-link-active router-link-exact-active toc-link level3">é…ç½®è¿‡æ»¤å™¨é“¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#é€€å‡ºç™»å½•" class="router-link-active router-link-exact-active toc-link level3">é€€å‡ºç™»å½•</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#æˆæƒ" class="router-link-active router-link-exact-active toc-link level2">æˆæƒ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#æˆæƒåŸºæœ¬æµç¨‹" class="router-link-active router-link-exact-active toc-link level3">æˆæƒåŸºæœ¬æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#æˆæƒå®ç°" class="router-link-active router-link-exact-active toc-link level3">æˆæƒå®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#å°è£…æƒé™ä¿¡æ¯" class="router-link-active router-link-exact-active toc-link level3">å°è£…æƒé™ä¿¡æ¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#sql-æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢æƒé™" class="router-link-active router-link-exact-active toc-link level3">sql(æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢æƒé™)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#ä»£ç å®ç°" class="router-link-active router-link-exact-active toc-link level3">ä»£ç å®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#æµ‹è¯•-redisåºåˆ—åŒ–æŠ¥é”™-å°šæœªè§£å†³" class="router-link-active router-link-exact-active toc-link level3">æµ‹è¯•ï¼šredisåºåˆ—åŒ–æŠ¥é”™ï¼Œå°šæœªè§£å†³</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨" class="router-link-active router-link-exact-active toc-link level2">è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è·¨åŸŸ" class="router-link-active router-link-exact-active toc-link level2">è·¨åŸŸ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#æ‹¦æˆªå™¨æ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">æ‹¦æˆªå™¨æ–¹å¼</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•" class="router-link-active router-link-exact-active toc-link level2">è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰è®¤è¯æˆåŠŸå¤„ç†å™¨" class="router-link-active router-link-exact-active toc-link level2">è‡ªå®šä¹‰è®¤è¯æˆåŠŸå¤„ç†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨-1" class="router-link-active router-link-exact-active toc-link level2">è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#æ³¨é”€æˆåŠŸå¤„ç†å™¨" class="router-link-active router-link-exact-active toc-link level2">æ³¨é”€æˆåŠŸå¤„ç†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#oauth2-0" class="router-link-active router-link-exact-active toc-link level2">OAuth2.0</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#è§’è‰²-åº”ç”¨ã€apiå’Œç”¨æˆ·" class="router-link-active router-link-exact-active toc-link level3">è§’è‰²ï¼šåº”ç”¨ã€apiå’Œç”¨æˆ·</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#å››ç§æˆæƒæ¨¡å¼" class="router-link-active router-link-exact-active toc-link level3">å››ç§æˆæƒæ¨¡å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#ç†è®ºåŸºç¡€-javaç”ŸæˆäºŒç»´ç " class="router-link-active router-link-exact-active toc-link level3">ç†è®ºåŸºç¡€-javaç”ŸæˆäºŒç»´ç </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/posts/banana/java/security.html#å¾®ä¿¡æ‰«ç ç™»å½•" class="router-link-active router-link-exact-active toc-link level3">å¾®ä¿¡æ‰«ç ç™»å½•</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="spring-security" tabindex="-1"><a class="header-anchor" href="#spring-security" aria-hidden="true">#</a> Spring Security</h1><p><a href="https://www.bilibili.com/video/BV1mm4y1X7Hc/?spm_id_from=333.999.0.0&amp;vd_source=f25f5a8d75a3a60d5a288f726803ec11" target="_blank" rel="noopener noreferrer">SpringSecurityæ¡†æ¶æ•™ç¨‹-Spring Security+JWTå®ç°é¡¹ç›®çº§å‰ç«¯åˆ†ç¦»è®¤è¯æˆæƒ-æŒ‘æˆ˜é»‘é©¬&amp;å°šç¡…è°·_å“”å“©å“”å“©_bilibili<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://blog.csdn.net/qq_44709990/article/details/123082560" target="_blank" rel="noopener noreferrer">ã€ç²¾é€‰ã€‘ã€å…¨ç½‘æœ€ç»†è‡´ã€‘SpringBootæ•´åˆSpring Security + JWTå®ç°ç”¨æˆ·è®¤è¯_springboot springsecurity jwt_å°çµå®çš„åšå®¢-CSDNåšå®¢<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.cnblogs.com/qiantao/p/14605154.html" target="_blank" rel="noopener noreferrer">springbootæ•´åˆspringsecurityæœ€å®Œæ•´ï¼Œåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† - QianTM - åšå®¢å›­ (cnblogs.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="ä¾èµ–-application-yml" tabindex="-1"><a class="header-anchor" href="#ä¾èµ–-application-yml" aria-hidden="true">#</a> ä¾èµ–, application.yml</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code> <span class="token comment">&lt;!-- springboot security --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼•å…¥ä¾èµ–å¯åŠ¨åç™»å½•ï¼ˆé»˜è®¤ç”¨æˆ·åï¼šuser ï¼Œå¯†ç ï¼š æ§åˆ¶å°ä¼šè¾“å‡ºå¯†ç ï¼‰</p><p>å¯åŠ¨ç±»æ³¨è§£ä¿®æ”¹å¦‚ä¸‹ å¯ä»¥è·³è¿‡é»˜è®¤ç™»å½•é¡µ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@SpringBootApplication(exclude = SecurityAutoConfiguration.class)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ä»–ç”¨åˆ°çš„ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>        <span class="token comment">&lt;!--redisä¾èµ–--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--fastjsonä¾èµ–--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.42<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--jwtä¾èµ–--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--mybatis-plus--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--mysql--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8092</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/shiro<span class="token punctuation">-</span>test<span class="token punctuation">?</span>serverTimezone=GMT%2B8<span class="token important">&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment"># RedisæœåŠ¡å™¨åœ°å€</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
    <span class="token comment"># RedisæœåŠ¡å™¨ç«¯å£å·</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token comment"># ä½¿ç”¨çš„æ•°æ®åº“ç´¢å¼•ï¼Œé»˜è®¤æ˜¯0</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token comment"># è®¾ç½®å¯†ç   æ²¡æœ‰å¯†ç ä¸è¦å†™ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">&quot;123456&quot;</span>
    <span class="token comment"># é»˜è®¤lettuce  ï¼Œå¯ä»¥é…ç½®ä½¿ç”¨jedis</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment"># æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼Œè´Ÿæ•°è¡¨ç¤ºæ²¡æœ‰é™åˆ¶</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1</span>
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token comment"># è¿æ¥æ± ä¸­æœ€å¤§è¿æ¥æ•°ï¼Œè´Ÿæ•°è¡¨ç¤ºæ²¡æœ‰é™åˆ¶</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">20</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç™»å½•éªŒè¯æµç¨‹" tabindex="-1"><a class="header-anchor" href="#ç™»å½•éªŒè¯æµç¨‹" aria-hidden="true">#</a> ç™»å½•éªŒè¯æµç¨‹</h2><p><img src="/blog/202310220123889.png" alt="" loading="lazy"></p><p><img src="/blog/202310220138839.png" alt="image-20231022013812741" loading="lazy"></p><p>è®¤è¯æµç¨‹ï¼š</p><p><img src="/blog/202310220158198.png" alt="image-20231022015805093" loading="lazy"></p><p>Authenticationæ¥å£ï¼šå®ƒçš„å®ç°ç±»ï¼Œè¡¨ç¤ºå½“å‰è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå°è£…äº†ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚ AuthenticationManageræ¥å£ï¼šå®šä¹‰äº†è®¤è¯Authenticationçš„æ–¹æ³• UserDetailsServiceæ¥å£ï¼šåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ã€‚é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ã€‚ UserDetailsiæ¥å£ï¼šæä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚é€šè¿‡UserDetailsServiceæ ¹æ®ç”¨æˆ·åè·å–å¤„ç†çš„ç”¨æˆ·ä¿¡æ¯è¦å°è£…æˆJserDetailså¯¹è±¡è¿”å›ã€‚ç„¶åå°† è¿™äº›ä¿¡æ¯å°è£…åˆ°Authenticationå¯¹è±¡ä¸­ã€‚</p><h2 id="æ€è·¯" tabindex="-1"><a class="header-anchor" href="#æ€è·¯" aria-hidden="true">#</a> æ€è·¯</h2><p>ç™»å½• â‘ è‡ªå®šä¹‰ç™»å½•æ¥â–£ è°ƒç”¨ProviderManagerçš„æ–¹æ³•è¿›è¡Œè®¤è¯å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆjwt æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisä¸­l â‘¡è‡ªå®šä¹‰UserDetailsService åœ¨è¿™ä¸ªå®ç°åˆ—ä¸­å»æŸ¥è¯¢æ•°æ®åº“</p><p>æ ¡éªŒï¼š â‘ å®šä¹‰wtè®¤è¯è¿‡æ»¤å™¨ è·å–token è§£ætokenè·å–å…¶ä¸­çš„userid ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ å­˜å…¥SecurityContextHolder</p><h2 id="è¡¨è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#è¡¨è®¾è®¡" aria-hidden="true">#</a> è¡¨è®¾è®¡</h2><p>å‚è€ƒshiroä¸­çš„æƒé™è¡¨è®¾è®¡ã€‚</p><h2 id="è¿”å›ç»“æœç±»å‹result" tabindex="-1"><a class="header-anchor" href="#è¿”å›ç»“æœç±»å‹result" aria-hidden="true">#</a> è¿”å›ç»“æœç±»å‹Result</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span> <span class="token comment">//ç¼–ç ï¼š1æˆåŠŸï¼Œ0å’Œå…¶å®ƒæ•°å­—ä¸ºå¤±è´¥</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span> <span class="token comment">//é”™è¯¯ä¿¡æ¯</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span> <span class="token comment">//æ•°æ®</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">T</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span>data <span class="token operator">=</span> object<span class="token punctuation">;</span>
        result<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Result</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        result<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redisé…ç½®" tabindex="-1"><a class="header-anchor" href="#redisé…ç½®" aria-hidden="true">#</a> Redisé…ç½®</h2><h3 id="redisconfig" tabindex="-1"><a class="header-anchor" href="#redisconfig" aria-hidden="true">#</a> RedisConfig</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">STANDARD_PATTERN</span> <span class="token operator">=</span> <span class="token string">&quot;yyyy/MM/dd HH:mm:ss&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DATE_PATTERN</span> <span class="token operator">=</span> <span class="token string">&quot;yyyy/MM/dd&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TIME_PATTERN</span> <span class="token operator">=</span> <span class="token string">&quot;HH:mm:ss&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä½¿ç”¨Jackson2JsonRedisSerialize æ›¿æ¢é»˜è®¤åºåˆ—åŒ–</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> jackson2JsonRedisSerializer <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">activateDefaultTyping</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">getPolymorphicTypeValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">,</span>
                <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>As</span><span class="token punctuation">.</span><span class="token constant">PROPERTY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token class-name">SerializationFeature</span><span class="token punctuation">.</span><span class="token constant">FAIL_ON_EMPTY_BEANS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">DeserializationFeature</span><span class="token punctuation">.</span><span class="token constant">FAIL_ON_UNKNOWN_PROPERTIES</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerLocalDateTime</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span>
        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å¤„ç†æ—¶é—´ç±»å‹
     *
     * <span class="token keyword">@param</span> <span class="token parameter">objectMapper</span>
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerLocalDateTime</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper</span> objectMapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è®¾ç½®java.util.Dateæ—¶é—´ç±»çš„åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–çš„æ ¼å¼</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">setDateFormat</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token constant">STANDARD_PATTERN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">JavaTimeModule</span> timeModule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaTimeModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// LocalDateTime</span>
        <span class="token class-name">DateTimeFormatter</span> dateTimeFormatter <span class="token operator">=</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token constant">STANDARD_PATTERN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeModule<span class="token punctuation">.</span><span class="token function">addSerializer</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateTimeSerializer</span><span class="token punctuation">(</span>dateTimeFormatter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeModule<span class="token punctuation">.</span><span class="token function">addDeserializer</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateTimeDeserializer</span><span class="token punctuation">(</span>dateTimeFormatter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// LocalDate</span>
        <span class="token class-name">DateTimeFormatter</span> dateFormatter <span class="token operator">=</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token constant">DATE_PATTERN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeModule<span class="token punctuation">.</span><span class="token function">addSerializer</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateSerializer</span><span class="token punctuation">(</span>dateFormatter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeModule<span class="token punctuation">.</span><span class="token function">addDeserializer</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateDeserializer</span><span class="token punctuation">(</span>dateFormatter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// LocalTime</span>
        <span class="token class-name">DateTimeFormatter</span> timeFormatter <span class="token operator">=</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token constant">TIME_PATTERN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeModule<span class="token punctuation">.</span><span class="token function">addSerializer</span><span class="token punctuation">(</span><span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalTimeSerializer</span><span class="token punctuation">(</span>timeFormatter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeModule<span class="token punctuation">.</span><span class="token function">addDeserializer</span><span class="token punctuation">(</span><span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalTimeDeserializer</span><span class="token punctuation">(</span>timeFormatter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectMapper<span class="token punctuation">.</span><span class="token function">registerModule</span><span class="token punctuation">(</span>timeModule<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rediscache-å·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#rediscache-å·¥å…·ç±»" aria-hidden="true">#</a> RedisCache(å·¥å…·ç±»)</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisCache</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡ã€‚Integer String å®ä½“ç±»
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span>  ç¼“å­˜çš„é”®å€¼
     * <span class="token keyword">@param</span> <span class="token parameter">value</span> ç¼“å­˜çš„å€¼
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@return</span>    ç¼“å­˜çš„å¯¹è±¡
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">setCacheObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">T</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> operations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        operations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> operations<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span>  ç¼“å­˜çš„é”®å€¼
     * <span class="token keyword">@param</span> <span class="token parameter">value</span>  ç¼“å­˜çš„å€¼
     * <span class="token keyword">@param</span> <span class="token parameter">timeout</span>  æ—¶é—´
     * <span class="token keyword">@param</span> <span class="token parameter">timeUnit</span>  æ—¶é—´é¢—ç²’åº¦
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@return</span>   ç¼“å­˜çš„å¯¹è±¡
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">setCacheObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">T</span> value<span class="token punctuation">,</span> <span class="token class-name">Integer</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> timeUnit<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> operations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        operations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> timeUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> operations<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span>   ç¼“å­˜é”®å€¼
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@return</span>   ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getCacheObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> operations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> operations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åˆ é™¤å•ä¸ªå¯¹è±¡
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteObject</span><span class="token punctuation">(</span><span class="token class-name">String</span>  key<span class="token punctuation">)</span><span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * åˆ é™¤é›†åˆå¯¹è±¡
     *
     * <span class="token keyword">@param</span> <span class="token parameter">collection</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteObject</span><span class="token punctuation">(</span><span class="token class-name">Collection</span> collection<span class="token punctuation">)</span><span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * ç¼“å­˜listæ•°æ®
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span>    ç¼“å­˜çš„é”®å€¼
     * <span class="token keyword">@param</span> <span class="token parameter">dataList</span>    å¸¦ç¼“å­˜çš„listæ•°æ®
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@return</span>    ç¼“å­˜çš„å¯¹è±¡
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ListOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">setCacheList</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ListOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> listOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataList <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> size <span class="token operator">=</span> dataList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                listOperations<span class="token punctuation">.</span><span class="token function">leftPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> dataList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> listOperations<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     *  è·å¾—ç¼“å­˜çš„listå¯¹è±¡
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span>  ç¼“å­˜çš„é”®å€¼
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@return</span>   ç¼“å­˜é”®å€¼å¯¹åº”çš„é›†åˆæ•°æ®
     */</span>
    <span class="token keyword">public</span>  <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCacheList</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ListOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> listOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span> size <span class="token operator">=</span> listOperations<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>listOperations<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ç¼“å­˜Set
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span> ç¼“å­˜é”®å€¼
     * <span class="token keyword">@param</span> <span class="token parameter">dataSet</span> ç¼“å­˜çš„æ•°æ®
     * <span class="token keyword">@return</span> ç¼“å­˜æ•°æ®çš„å¯¹è±¡
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">BoundSetOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">setCacheSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> dataSet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BoundSetOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> setOperation <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> it <span class="token operator">=</span> dataSet<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            setOperation<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> setOperation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è·å¾—ç¼“å­˜çš„set
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCacheSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> dataSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BoundSetOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> operation <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSet <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataSet<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ç¼“å­˜Map
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span>
     * <span class="token keyword">@param</span> <span class="token parameter">dataMap</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">HashOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">setCacheMap</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> dataMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashOperations</span> hashOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> dataMap<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> dataMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                hashOperations<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> hashOperations<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è·å¾—ç¼“å­˜çš„Map
     *
     * <span class="token keyword">@param</span> <span class="token parameter">key</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCacheMap</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     *è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡åˆ—è¡¨
     * <span class="token keyword">@param</span> <span class="token parameter">pattern</span>  å­—ç¬¦ä¸²å‰ç¼€
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">keys</span><span class="token punctuation">(</span><span class="token class-name">String</span> pattern<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å®ä½“ç±»" tabindex="-1"><a class="header-anchor" href="#å®ä½“ç±»" aria-hidden="true">#</a> å®ä½“ç±»</h2><h3 id="user" tabindex="-1"><a class="header-anchor" href="#user" aria-hidden="true">#</a> User</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;sys_users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> salt<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> locked<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="loginuser-securityç™»é™†æ—¶ä½¿ç”¨åˆ°" tabindex="-1"><a class="header-anchor" href="#loginuser-securityç™»é™†æ—¶ä½¿ç”¨åˆ°" aria-hidden="true">#</a> LoginUser (securityç™»é™†æ—¶ä½¿ç”¨åˆ°)</h3><p>é‡å†™UserDetailsæ¥å£å®ç°ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">GrantedAuthority</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> å¼ å¸†
 * <span class="token keyword">@version</span> 1.0
 * Create by 2023/10/27 20:06
 */</span>
<span class="token comment">// é‡å†™ UserDetails çš„æ–¹æ³•</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginUser</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetails</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>     <span class="token comment">//è‡ªå·±å†™çš„å®ä½“ç±»</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–å¯†ç </span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–ç”¨æˆ·å</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//  ä¸‹é¢çš„å››ä¸ªåŸæ¥è¿”å›æ˜¯falseï¼Œæ”¹ä¸º trueï¼Œæ–¹ä¾¿æµ‹è¯•ä½¿ç”¨</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="permission" tabindex="-1"><a class="header-anchor" href="#permission" aria-hidden="true">#</a> permission</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;sys_permissions&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Permission</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> permission<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é‡å†™-userdetailservice-securityåŒ…é‡Œçš„" tabindex="-1"><a class="header-anchor" href="#é‡å†™-userdetailservice-securityåŒ…é‡Œçš„" aria-hidden="true">#</a> é‡å†™ UserDetailService (securityåŒ…é‡Œçš„)</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="userdetailsservice" tabindex="-1"><a class="header-anchor" href="#userdetailsservice" aria-hidden="true">#</a> UserDetailsService</h3><div class="language-Java line-numbers-mode" data-ext="Java"><pre class="language-Java"><code>package com.example.security.security.service;

import com.example.security.security.domain.LoginUser;

public interface UserDetailsService {
    LoginUser loadUserByUsername(String username);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="userdetailsserviceimpl" tabindex="-1"><a class="header-anchor" href="#userdetailsserviceimpl" aria-hidden="true">#</a> UserDetailsServiceImpl</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>service<span class="token punctuation">.</span>serviceImpl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">LoginUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">UserMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UsernameNotFoundException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Objects</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> å¼ å¸†
 * <span class="token keyword">@version</span> 1.0
 * Create by 2023/10/22 16:01
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDetailsServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span>
        <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> lambdaQueryWrapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lambdaQueryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span>userMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>lambdaQueryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°ç”¨æˆ·å°±æŠ›å‡ºå¼‚å¸¸</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// TODO æŸ¥è¯¢å¯¹åº”çš„æƒé™ä¿¡æ¯</span>
        
        <span class="token comment">// LoginUser implements UserDetails,æ‰€ä»¥è¿”å›ç±»å‹æ˜¯ UserDetails</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LoginUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨scurityç™»å½•é¡µç™»å½•-æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨scurityç™»å½•é¡µç™»å½•-æ•°æ®åº“" aria-hidden="true">#</a> ä½¿ç”¨Scurityç™»å½•é¡µç™»å½•ï¼ˆæ•°æ®åº“ï¼‰</h2><p>ç›´æ¥ä½¿ç”¨æ•°æ®åº“çš„ç”¨æˆ·åã€‚å¯†ç ç™»å½•æ—¶è·³è½¬å¤±è´¥ï¼›</p><p>å› ä¸ºç°åœ¨æ•°æ®åº“ä¸­çš„å¯†ç æ˜¯æœªåŠ å¯†çš„ï¼Œä½¿ç”¨securityçš„ç™»é™†æ—¶ä¼šå¤±è´¥ã€‚</p><p>è§£å†³ï¼šåœ¨æ•°æ®åº“çš„å¯†ç å‰é¢åŠ ä¸Š {noop} ï¼ˆè¡¨ç¤ºå¯†ç æ˜¯æ˜æ–‡å­˜å‚¨çš„ï¼‰ï¼Œå†ç™»é™†è·³è½¬æˆåŠŸ</p><h2 id="å¯†ç åŠ å¯†å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#å¯†ç åŠ å¯†å­˜å‚¨" aria-hidden="true">#</a> å¯†ç åŠ å¯†å­˜å‚¨</h2><p>å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬ä¸ä¼šæŠŠå¯†ç æ˜æ–‡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ é»˜è®¤ä½¿ç”¨çš„PasswordEncoderè¦æ±‚æ•°æ®åº“ä¸­çš„å¯†ç æ ¼å¼ä¸ºï¼š{id}passwordã€‚å®ƒä¼šæ ¹æ®idå»åˆ¤æ–­å¯†ç çš„åŠ å¯†æ–¹å¼ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šé‡‡ ç”¨è¿™ç§æ–¹å¼ã€‚æ‰€ä»¥å°±éœ€è¦æ›¿æ¢PasswordEncoderã€‚</p><p>æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨Spring Securityä¸ºæˆ‘ä»¬æä¾›çš„ BCryptPasswordEncoderï¼›</p><p>æˆ‘ä»¬åªéœ€è¦æŠŠ BCryptPasswordEncoderå¯¹è±¡æ³¨å…¥åˆ°Springå®¹å™¨ä¸­ï¼ŒSpring Securityå°±ä¼šä½¿ç”¨è¯¥PasswordEncoderæ¥è¿›è¡Œå¯†ç æ ¡éªŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªSpring Securityé…ç½®ç±»ï¼Œè¯¥é…ç½®ç±»éœ€è¦ç»§æ‰¿ WebSecurityConfigurerAdapterã€‚</p><p><a href="https://blog.csdn.net/manqishizhizhu/article/details/124201084" target="_blank" rel="noopener noreferrer">SpringBootæ•´åˆSpringSecurityå®ç°å¯†ç åŠ å¯†è§£å¯†ã€ç™»å½•è®¤è¯é€€å‡ºåŠŸèƒ½_springsecurityå–æ¶ˆç™»å½•éªŒè¯_rabbit_zliçš„åšå®¢-CSDNåšå®¢<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="securityconfig" tabindex="-1"><a class="header-anchor" href="#securityconfig" aria-hidden="true">#</a> SecurityConfig</h3><p>ä»£ç æç¤ºï¼šWebSecurityConfigurerAdapterè¿‡æ—¶äº†</p><div class="language-Java line-numbers-mode" data-ext="Java"><pre class="language-Java"><code>@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    /**
     * åˆ›å»ºBCryptPasswordEncoderæ³¨å…¥å®¹å™¨
     * @return
     */
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="passwordencoderæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#passwordencoderæµ‹è¯•" aria-hidden="true">#</a> passwordEncoderæµ‹è¯•</h3><p>æ‰“å°å‡ºæ¥çš„passwordEncodedï¼ŒpasswordEncoded2ç»“æœä¸ä¸€æ ·</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">TestBCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">BCryptPasswordEncoder</span> passwordEncoder<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> passwordEncoded<span class="token operator">=</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> passwordEncoded2<span class="token operator">=</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>passwordEncoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>passwordEncoded2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;$2a$10$RbxwDc11pJX0zpTy/wDzwuAqZC2oX/O81TTdt5E1ZbCPkP6VzGZgC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;$2a$10$2ikCvXpvoVGifg.rQjg2geaU5k0JyFC1gftG7UNXUbTfCSjKd4Dbi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

$<span class="token number">2</span>a$<span class="token number">10</span>$<span class="token class-name">RbxwDc11pJX0zpTy</span><span class="token operator">/</span>wDzwuAqZC2oX<span class="token operator">/</span><span class="token class-name">O81TTdt5E1ZbCPkP6VzGZgC</span>
$<span class="token number">2</span>a$<span class="token number">10</span>$<span class="token number">2</span>ikCvXpvoVGifg<span class="token punctuation">.</span>rQjg2geaU5k0JyFC1gftG7UNXUbTfCSjKd4Dbi
    <span class="token boolean">true</span>
    <span class="token boolean">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é¡µé¢æµ‹è¯•-è´¦å·-å¯†ç ç™»å½•" tabindex="-1"><a class="header-anchor" href="#é¡µé¢æµ‹è¯•-è´¦å·-å¯†ç ç™»å½•" aria-hidden="true">#</a> é¡µé¢æµ‹è¯•ï¼ˆè´¦å·ï¼Œå¯†ç ç™»å½•ï¼‰</h3><p>æ•°æ®åº“æ–°å¢ç”¨æˆ·ï¼š security 1234 , å­˜å‚¨åŠ å¯†åçš„å¯†ç  security $2a<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span>RbxwDc11pJX0zpTy/wDzwuAqZC2oX/O81TTdt5E1ZbCPkP6VzGZgC</p><p>é¡µé¢ç™»å½• security 1234 åè·³è½¬æ­£å¸¸</p><h2 id="jwt" tabindex="-1"><a class="header-anchor" href="#jwt" aria-hidden="true">#</a> JWT</h2><h3 id="jwtå·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#jwtå·¥å…·ç±»" aria-hidden="true">#</a> jwtå·¥å…·ç±»</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>jsonwebtoken<span class="token punctuation">.</span></span><span class="token class-name">Claims</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>jsonwebtoken<span class="token punctuation">.</span></span><span class="token class-name">JwtBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>jsonwebtoken<span class="token punctuation">.</span></span><span class="token class-name">Jwts</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>jsonwebtoken<span class="token punctuation">.</span></span><span class="token class-name">SignatureAlgorithm</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">SecretKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">SecretKeySpec</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * JWTå·¥å…·ç±»
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtUtil</span> <span class="token punctuation">{</span>

    <span class="token comment">//æœ‰æ•ˆæœŸä¸º</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Long</span> <span class="token constant">JWT_TTL</span> <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span><span class="token number">1000L</span><span class="token punctuation">;</span><span class="token comment">// 60 * 60 *1000  ä¸€ä¸ªå°æ—¶</span>
    <span class="token comment">//è®¾ç½®ç§˜é’¥æ˜æ–‡</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">JWT_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;rabbit&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> token<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ç”Ÿæˆjtw
     * <span class="token keyword">@param</span> <span class="token parameter">subject</span> tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createJWT</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JwtBuilder</span> builder <span class="token operator">=</span> <span class="token function">getJwtBuilder</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®è¿‡æœŸæ—¶é—´</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ç”Ÿæˆjtw
     * <span class="token keyword">@param</span> <span class="token parameter">subject</span> tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰
     * <span class="token keyword">@param</span> <span class="token parameter">ttlMillis</span> tokenè¶…æ—¶æ—¶é—´
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createJWT</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">Long</span> ttlMillis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JwtBuilder</span> builder <span class="token operator">=</span> <span class="token function">getJwtBuilder</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> ttlMillis<span class="token punctuation">,</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®è¿‡æœŸæ—¶é—´</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">JwtBuilder</span> <span class="token function">getJwtBuilder</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">Long</span> ttlMillis<span class="token punctuation">,</span> <span class="token class-name">String</span> uuid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SignatureAlgorithm</span> signatureAlgorithm <span class="token operator">=</span> <span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span><span class="token constant">HS256</span><span class="token punctuation">;</span>
        <span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> <span class="token function">generalKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> nowMillis <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Date</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>nowMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ttlMillis<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            ttlMillis<span class="token operator">=</span><span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token constant">JWT_TTL</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> expMillis <span class="token operator">=</span> nowMillis <span class="token operator">+</span> ttlMillis<span class="token punctuation">;</span>
        <span class="token class-name">Date</span> expDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>expMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span>              <span class="token comment">//å”¯ä¸€çš„ID</span>
                <span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span>   <span class="token comment">// ä¸»é¢˜  å¯ä»¥æ˜¯JSONæ•°æ®</span>
                <span class="token punctuation">.</span><span class="token function">setIssuer</span><span class="token punctuation">(</span><span class="token string">&quot;sg&quot;</span><span class="token punctuation">)</span>     <span class="token comment">// ç­¾å‘è€…</span>
                <span class="token punctuation">.</span><span class="token function">setIssuedAt</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>      <span class="token comment">// ç­¾å‘æ—¶é—´</span>
                <span class="token punctuation">.</span><span class="token function">signWith</span><span class="token punctuation">(</span>signatureAlgorithm<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span> <span class="token comment">//ä½¿ç”¨HS256å¯¹ç§°åŠ å¯†ç®—æ³•ç­¾å, ç¬¬äºŒä¸ªå‚æ•°ä¸ºç§˜é’¥</span>
                <span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>expDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åˆ›å»ºtoken
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@param</span> <span class="token parameter">subject</span>
     * <span class="token keyword">@param</span> <span class="token parameter">ttlMillis</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createJWT</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">Long</span> ttlMillis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JwtBuilder</span> builder <span class="token operator">=</span> <span class="token function">getJwtBuilder</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> ttlMillis<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®è¿‡æœŸæ—¶é—´</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//String jwt = createJWT(&quot;2123&quot;);  ç”Ÿæˆjwt</span>
        <span class="token comment">//System.out.println(jwt); </span>
        <span class="token comment">// è§£å¯†jwt</span>
        <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token function">parseJWT</span><span class="token punctuation">(</span><span class="token string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJkODM4YmM4NWJiODI0NjYzOTFjZTA0ODUyOGExZmQ2ZSIsInN1YiI6IjIxMjMiLCJpc3MiOiJzZyIsImlhdCI6MTY5ODQxMzU5OCwiZXhwIjoxNjk4NDE3MTk4fQ.sn9HPRiudLhaWfpqqPsKJnxXjtp8ZDpeEZD69WBF39o&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> subject <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// System.out.println(claims);</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ç”ŸæˆåŠ å¯†åçš„ç§˜é’¥ secretKey
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SecretKey</span> <span class="token function">generalKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encodedKey <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token constant">JWT_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecretKey</span> key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>encodedKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> encodedKey<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è§£æ
     *
     * <span class="token keyword">@param</span> <span class="token parameter">jwt</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Claims</span> <span class="token function">parseJWT</span><span class="token punctuation">(</span><span class="token class-name">String</span> jwt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> <span class="token function">generalKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>jwt<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è‡ªå®šä¹‰ç™»å½•æ¥å£" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç™»å½•æ¥å£" aria-hidden="true">#</a> è‡ªå®šä¹‰ç™»å½•æ¥å£</h2><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰çš„æ¥å£ï¼Œä¸éœ€è¦ç™»å½•ä¹Ÿèƒ½è®¿é—®ï¼Œæ¯”å¦‚ï¼šç™»å½•é¡µé¢ã€æ³¨å†Œã€å¿˜è®°å¯†ç ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ Spring Securityé…ç½®ä¸€äº›ä¿¡æ¯ä»¥åŠç¼–å†™ä¸€äº›æ”¾è¡Œçš„æ–¹æ³•ï¼š åœ¨æ¥å£ä¸­æˆ‘ä»¬é€šè¿‡ AuthenticationManager çš„ authenticate() æ–¹æ³•æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œæ‰€ä»¥éœ€è¦åœ¨ SecurityConfig ä¸­é…ç½®æŠŠ AuthenticationManager æ³¨å…¥Spring IoCå®¹å™¨ è®¤è¯æˆåŠŸçš„è¯ï¼Œéœ€è¦ç”Ÿæˆä¸€ä¸ª JWTï¼Œæ”¾å…¥å“åº”ä¸­è¿”å›ã€‚å¹¶ä¸”ä¸ºäº†è®©ç”¨æˆ·ä¸‹å›è¯·æ±‚æ—¶èƒ½é€šè¿‡ JWT è¯†åˆ«å¤„å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥Redis</p><h3 id="è‡ªå®šä¹‰ç™»å½•æ¥å£-1" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç™»å½•æ¥å£-1" aria-hidden="true">#</a> è‡ªå®šä¹‰ç™»å½•æ¥å£</h3><p>è°ƒç”¨ProviderManagerçš„æ–¹æ³•è¿›è¡Œè®¤è¯å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆjwt ï¼Œ æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisä¸­</p><h3 id="securityconfigä¸­é‡å†™-authenticationmanager" tabindex="-1"><a class="header-anchor" href="#securityconfigä¸­é‡å†™-authenticationmanager" aria-hidden="true">#</a> SecurityConfigä¸­é‡å†™ AuthenticationManager</h3><p>å¯¹äºä¸éœ€è¦ç™»å½•å°±å¯ä»¥è®¿é—®çš„æ¥å£åœ¨è¿™é‡Œé…ç½®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * åˆ›å»ºBCryptPasswordEncoderæ³¨å…¥å®¹å™¨
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http
                <span class="token comment">// å…³é—­ csrf</span>
                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¸é€šè¿‡sessionè·å–SecurityContext</span>
                <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®(ä¸ç™»é™†)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/loginByPhone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token comment">// é™¤äº†ä¸Šé¢çš„è¯·æ±‚ï¼Œä»»ä½•è¯·æ±‚éƒ½éœ€è¦é‰´æƒè®¤è¯</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="logincontroller" tabindex="-1"><a class="header-anchor" href="#logincontroller" aria-hidden="true">#</a> LoginController</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LoginService</span> loginService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç™»å½•&quot;</span><span class="token operator">+</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç™»å½•</span>
        <span class="token keyword">return</span> loginService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="loginservice" tabindex="-1"><a class="header-anchor" href="#loginservice" aria-hidden="true">#</a> LoginService</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LoginService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span>  <span class="token class-name">Result</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="loginserviceimpl" tabindex="-1"><a class="header-anchor" href="#loginserviceimpl" aria-hidden="true">#</a> LoginServiceImpl</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">LoginService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisCache</span> redisCache<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//AuthenticationManager authenticate() æ–¹æ³•æ¥è¿›è¡Œç”¨æˆ·è®¤è¯</span>
        <span class="token class-name">UsernamePasswordAuthenticationToken</span> authenticationToken<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Authentication</span> authentication<span class="token operator">=</span> authenticationManager<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>authenticationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¦‚æœè®¤è¯æ²¡é€šè¿‡ï¼Œç»™å‡ºå¯¹åº”çš„æç¤º</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;ç™»é™†å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//å¦‚æœè®¤è¯é€šè¿‡äº†ï¼Œä½¿ç”¨useridç”Ÿæˆä¸€ä¸ªjwt jwtå­˜å…¥Resultè¿”å›</span>
        <span class="token class-name">LoginUser</span> loginUser<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">LoginUser</span><span class="token punctuation">)</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userId<span class="token operator">=</span>loginUser<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> jwt<span class="token operator">=</span> <span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token function">createJWT</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span>jwt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æŠŠå®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯å­˜å…¥redis(éœ€è¦å¼€å¯redisï¼Œå¹¶é…ç½®å¥½redis)  useridä½œä¸ºkey</span>
        redisCache<span class="token punctuation">.</span><span class="token function">setCacheObject</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span><span class="token operator">+</span>userId<span class="token punctuation">,</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç™»é™†æˆåŠŸï¼Œè¿”å›token</span>
        <span class="token keyword">return</span>  <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®šä¹‰jwtè®¤è¯è¿‡æ»¤å™¨-token-è§£æè¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰jwtè®¤è¯è¿‡æ»¤å™¨-token-è§£æè¿‡æ»¤å™¨" aria-hidden="true">#</a> å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨(Token è§£æè¿‡æ»¤å™¨)</h3><p><strong>è·å–token</strong><strong>è§£ætokenè·å–å…¶ä¸­çš„userid</strong><strong>ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯</strong><strong>å­˜å…¥SecurityContextHolder</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtAuthenticationTokenFilter</span> <span class="token keyword">extends</span> <span class="token class-name">OncePerRequestFilter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisCache</span> redisCache<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. è·å–Token</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ²¡æœ‰è·å–åˆ°Token æ”¾è¡Œï¼Œè®©å…¶å®ƒè¿‡æ»¤å™¨å»æ‹¦æˆª</span>
            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. è§£æToken è·å–userID</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token function">parseJWT</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            userId <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Tokenå¼‚å¸¸!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 3. ä»Redisä¸­å–å‡ºç”¨æˆ·æ•°æ®</span>
        <span class="token class-name">String</span> redis_key <span class="token operator">=</span> <span class="token string">&quot;login:&quot;</span><span class="token operator">+</span>userId<span class="token punctuation">;</span>
        <span class="token class-name">LoginUser</span> loginUser<span class="token operator">=</span> redisCache<span class="token punctuation">.</span><span class="token function">getCacheObject</span><span class="token punctuation">(</span>redis_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Tokenå¼‚å¸¸! ç”¨æˆ·æœªç™»å½•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//  TODO 4. è·å–æƒé™ä¿¡æ¯æ‘è£…åˆ°Authenticationä¸­</span>
        <span class="token comment">//   å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥SecurityContextHolder</span>
        <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. æ”¾è¡Œ</span>
        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é…ç½®è¿‡æ»¤å™¨é“¾" tabindex="-1"><a class="header-anchor" href="#é…ç½®è¿‡æ»¤å™¨é“¾" aria-hidden="true">#</a> é…ç½®è¿‡æ»¤å™¨é“¾</h3><p>å‰é¢æˆ‘ä»¬å·²ç»ç¼–å†™å¥½äº† Spring Security çš„Tokenè§£æè¿‡æ»¤å™¨ï¼Œä½†æˆ‘ä»¬è¿˜éœ€å»é…ç½®è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”æˆ‘ä»¬æŠŠè¿‡æ»¤å™¨é…ç½®å¥½åè¿˜éœ€æŒ‡å®šå…¶åœ¨Springå®¹å™¨ä¸­çš„é¡ºåºï¼Œæ‰€ä»¥éœ€å°†æˆ‘ä»¬å‰é¢å†™å¥½çš„è§£æTokençš„è¿‡æ»¤å™¨é…ç½®åˆ°ç”¨æˆ·è®¤è¯æˆæƒçš„è¿‡æ»¤å™¨UsernamePasswordAuthenticationFilterå‰é¢ã€‚ åœ¨ SecurityConfig.java ä¸­çš„ configure() æ–¹æ³•ä¸­é…ç½® http.addFilterBefore()</p><p><strong>SecurityConfig</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>security<span class="token punctuation">.</span>security<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">JwtAuthenticationTokenFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span><span class="token class-name">AuthenticationManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">WebSecurityConfigurerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">SessionCreationPolicy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>bcrypt<span class="token punctuation">.</span></span><span class="token class-name">BCryptPasswordEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>password<span class="token punctuation">.</span></span><span class="token class-name">PasswordEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span><span class="token class-name">UsernamePasswordAuthenticationFilter</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
    

    <span class="token doc-comment comment">/**
     * åˆ›å»ºBCryptPasswordEncoderæ³¨å…¥å®¹å™¨
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JwtAuthenticationTokenFilter</span> jwtAuthenticationTokenFilter<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http
                <span class="token comment">// å…³é—­ csrf</span>
                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¸é€šè¿‡sessionè·å–SecurityContext</span>
                <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/loginByPhone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token comment">// é™¤äº†ä¸Šé¢çš„è¯·æ±‚ï¼Œä»»ä½•è¯·æ±‚éƒ½éœ€è¦é‰´æƒè®¤è¯</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ·»åŠ jwtAuthenticationTokenFilter</span>
        http<span class="token punctuation">.</span><span class="token function">addFilterBefore</span><span class="token punctuation">(</span>jwtAuthenticationTokenFilter<span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é€€å‡ºç™»å½•" tabindex="-1"><a class="header-anchor" href="#é€€å‡ºç™»å½•" aria-hidden="true">#</a> é€€å‡ºç™»å½•</h3><p>LoginControllerä¸­åŠ å…¥ é€€å‡º</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/logout&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> loginService<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>LoginService</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code> public Result logout();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>LoginService</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * 1. ä» SecurityContextHolder ä¸­è·å–ç”¨æˆ·ä¿¡æ¯(ID)
         * 2. ä»Redisä¸­åˆ é™¤å¯¹åº”çš„Key
         */</span>
        <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication
                <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">)</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">LoginUser</span> loginUser<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">LoginUser</span><span class="token punctuation">)</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> loginUser<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ ¹æ®Keyåˆ é™¤Redisçš„å€¼</span>
        redisCache<span class="token punctuation">.</span><span class="token function">deleteObject</span><span class="token punctuation">(</span><span class="token string">&quot;login:&quot;</span><span class="token operator">+</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;é€€å‡ºæˆåŠŸ~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æˆæƒ" tabindex="-1"><a class="header-anchor" href="#æˆæƒ" aria-hidden="true">#</a> æˆæƒ</h2><h3 id="æˆæƒåŸºæœ¬æµç¨‹" tabindex="-1"><a class="header-anchor" href="#æˆæƒåŸºæœ¬æµç¨‹" aria-hidden="true">#</a> æˆæƒåŸºæœ¬æµç¨‹</h3><p>åœ¨SpringSecurityä¸­ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„FilterSecuritylnterceptoræ¥è¿›è¡Œæƒé™æ ¡éªŒã€‚åœ¨FilterSecurityInterceptorä¸­ä¼šä» SecurityContextHolderè·å–å…¶ä¸­çš„Authentication,ç„¶åè·å–å…¶ä¸­çš„æƒé™ä¿¡æ¯ã€‚å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®å½“å‰èµ„æºæ‰€éœ€çš„æƒé™ã€‚ æ‰€ä»¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªéœ€è¦æŠŠå½“å‰ç™»å½•ç”¨æˆ·çš„æƒé™ä¿¡æ¯ä¹Ÿå­˜å…¥Authenticationã€‚. ç„¶åè®¾ç½®æˆ‘ä»¬çš„èµ„æºæ‰€éœ€è¦çš„æƒé™å³å¯ã€‚</p><h3 id="æˆæƒå®ç°" tabindex="-1"><a class="header-anchor" href="#æˆæƒå®ç°" aria-hidden="true">#</a> æˆæƒå®ç°</h3><p>SpringSecurityä¸ºæˆ‘ä»¬æä¾›äº†åŸºäºæ³¨è§£çš„æƒé™æ§åˆ¶æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­ä¸»è¦é‡‡ç”¨çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£å»æŒ‡å®šè®¿é—®å¯¹åº”çš„èµ„æº æ‰€éœ€çš„æƒé™ã€‚</p><p>å¼€å¯åŸºäºæ–¹æ³•çš„å®‰å…¨è®¤è¯æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨webå±‚çš„controllerå¯ç”¨æ³¨è§£æœºåˆ¶çš„å®‰å…¨ç¡®è®¤</p><p>SecurityConfig ç±»ä¸ŠåŠ ä¸Šæ³¨è§£</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@EnableGlobalMethodSecurity(prePostEnabled = true)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Spring Securityé»˜è®¤æ˜¯ç¦ç”¨æ³¨è§£çš„ï¼Œè¦æƒ³å¼€å¯æ³¨è§£ï¼Œéœ€è¦åœ¨ç»§æ‰¿WebSecurityConfigurerAdapterçš„ç±»ä¸ŠåŠ @EnableGlobalMethodSecurityæ³¨è§£ï¼Œæ¥åˆ¤æ–­ç”¨æˆ·å¯¹æŸä¸ªæ§åˆ¶å±‚çš„æ–¹æ³•æ˜¯å¦å…·æœ‰è®¿é—®æƒé™</strong></p><p>é€šè¿‡@PreAuthorizeæ ‡ç­¾æ§åˆ¶controllerå±‚æ¥å£æƒé™</p><p>testController</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;test&#39;)&quot;</span><span class="token punctuation">)</span>       <span class="token comment">//testæƒé™åç§°</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å°è£…æƒé™ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#å°è£…æƒé™ä¿¡æ¯" aria-hidden="true">#</a> å°è£…æƒé™ä¿¡æ¯</h3><p>æˆ‘ä»¬å‰é¢åœ¨å†™UserDetailsServicelmplçš„æ—¶å€™è¯´è¿‡ï¼Œåœ¨æŸ¥è¯¢å‡ºç”¨æˆ·åè¿˜è¦è·å–å¯¹åº”çš„æƒé™ä¿¡æ¯ï¼Œå°è£…åˆ°UserDetailsä¸­è¿”å›ã€‚ æˆ‘ä»¬å…ˆç›´æ¥æŠŠæƒé™ä¿¡æ¯å†™æ­»å°è£…åˆ°JserDetailsä¸­è¿›è¡Œæµ‹è¯•ã€‚ æˆ‘ä»¬ä¹‹å‰å®šä¹‰äº†UserDetailsçš„å®ç°ç±»LoginUser,æƒ³è¦è®©å…¶èƒ½å°è£…æƒé™ä¿¡æ¯å°±è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p><h4 id="ä¿®æ”¹loginuser" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹loginuser" aria-hidden="true">#</a> ä¿®æ”¹LoginUser</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginUser</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetails</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>

    <span class="token comment">//æƒé™åˆ—è¡¨</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permissions<span class="token punctuation">;</span>
	<span class="token comment">// å»ºä¸€ä¸ªæœ‰å‚æ„é€ </span>
    <span class="token keyword">public</span> <span class="token class-name">LoginUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permissions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>permissions <span class="token operator">=</span> permissions<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//  é‡å†™ getAuthorities å¢åŠ æƒé™ä¿¡æ¯</span>
    <span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>serialize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token comment">// å­˜redisä¸éœ€è¦åºåˆ—åŒ–</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//æŠŠpermissionsä¸­Stringç±»å‹çš„æƒé™ä¿¡ï¼Œæ¯å°è£…æˆSimpleGrantedAuthorityå¯¹è±¡</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>authorities<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> authorities<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//ä»¥ä¸‹ä¸¤ç§å†™æ³•æ‹©ä¸€å³å¯</span>
        <span class="token comment">// authorities=new ArrayList&lt;&gt;();</span>
        <span class="token comment">// for (String permission : permissions){</span>
        <span class="token comment">//    SimpleGrantedAuthority authority =new SimpleGrantedAuthority(permission);</span>
        <span class="token comment">//    authorities.add (authority);</span>
        <span class="token comment">// }</span>
        authorities <span class="token operator">=</span> permissions<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> authorities<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sql-æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢æƒé™" tabindex="-1"><a class="header-anchor" href="#sql-æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢æƒé™" aria-hidden="true">#</a> sql(æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢æƒé™)</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">DISTINCT</span> p<span class="token punctuation">.</span>permission
        <span class="token keyword">from</span> sys_users u<span class="token punctuation">,</span>sys_roles r<span class="token punctuation">,</span>sys_users_roles ur<span class="token punctuation">,</span>sys_permissions p<span class="token punctuation">,</span>sys_roles_permissions rp
        <span class="token keyword">where</span> u<span class="token punctuation">.</span>id<span class="token operator">=</span>ur<span class="token punctuation">.</span>user_id
          <span class="token operator">and</span> r<span class="token punctuation">.</span>id<span class="token operator">=</span>ur<span class="token punctuation">.</span>role_id
          <span class="token operator">and</span> r<span class="token punctuation">.</span>id<span class="token operator">=</span>rp<span class="token punctuation">.</span>role_id
          <span class="token operator">and</span> p<span class="token punctuation">.</span>id<span class="token operator">=</span>rp<span class="token punctuation">.</span>permission_id
          <span class="token operator">and</span> u<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä»£ç å®ç°" tabindex="-1"><a class="header-anchor" href="#ä»£ç å®ç°" aria-hidden="true">#</a> ä»£ç å®ç°</h3><p>æˆ‘ä»¬åªéœ€è¦æ ¹æ®ç”¨æˆ·idå»æŸ¥è¯¢åˆ°å…¶æ‰€å¯¹åº”çš„æƒé™ä¿¡æ¯å³å¯ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå®šä¹‰ä¸ªmapper,å…¶ä¸­æä¾›ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ®useridæŸ¥è¯¢æƒé™ä¿¡æ¯ã€‚</p><p><strong>UserDetailsServiceImpl</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span>
        <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> lambdaQueryWrapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lambdaQueryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span>userMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>lambdaQueryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°ç”¨æˆ·å°±æŠ›å‡ºå¼‚å¸¸</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// TODO æŸ¥è¯¢å¯¹åº”çš„æƒé™ä¿¡æ¯(é€šè¿‡æ¥å£è·å–)</span>
        <span class="token comment">//List&lt;String&gt; list =new ArrayList&lt;String&gt;(Arrays.asList(&quot;test&quot;,&quot;admin&quot;));</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span>permissionMapper<span class="token punctuation">.</span><span class="token function">selectPermissionByUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LoginUser</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>permissionMapper</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PermissionMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// æ ¹æ®ç”¨æˆ· id æŸ¥è¯¢æƒé™åˆ—è¡¨</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectPermissionByUserId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>permissionMapper.xml</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> <span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.example.security.security.mapper.PermissionMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectPermissionByUserId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Integer<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select p.permission
        from sys_users u,sys_roles r,sys_users_roles ur,sys_permissions p,sys_roles_permissions rp
        where u.id=ur.user_id
          and r.id=ur.role_id
          and r.id=rp.role_id
          and p.id=rp.permission_id
          and u.id=#{userId}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JwtAuthenticationTokenFilter ä¿®æ”¹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. è·å–Token</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ²¡æœ‰è·å–åˆ°Token æ”¾è¡Œï¼Œè®©å…¶å®ƒè¿‡æ»¤å™¨å»æ‹¦æˆª</span>
            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2. è§£æToken è·å–userID</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token class-name">JwtUtil</span><span class="token punctuation">.</span><span class="token function">parseJWT</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            userId <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Tokenå¼‚å¸¸!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 3. ä»Redisä¸­å–å‡ºç”¨æˆ·æ•°æ®ï¼ˆredisé…ç½®æœ‰è¯¯ï¼Œå¯èƒ½ä¼šæŠ¥é”™ï¼‰</span>
        <span class="token class-name">String</span> redis_key <span class="token operator">=</span> <span class="token string">&quot;login:&quot;</span><span class="token operator">+</span>userId<span class="token punctuation">;</span>
        <span class="token class-name">LoginUser</span> loginUser<span class="token operator">=</span> redisCache<span class="token punctuation">.</span><span class="token function">getCacheObject</span><span class="token punctuation">(</span>redis_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// LoginUser loginUser =(LoginUser) redisTemplate.opsForValue().get(redis_key);</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Tokenå¼‚å¸¸! ç”¨æˆ·æœªç™»å½•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//  TODO 4. è·å–æƒé™ä¿¡æ¯æ‘è£…åˆ°Authenticationä¸­</span>
        <span class="token comment">//   å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥SecurityContextHolder</span>
        <span class="token comment">//   æ³¨æ„ç¬¬ä¸‰ä¸ªå‚æ•°ç”± null æ”¹ä¸ºäº†loginUser.getAuthorities()</span>
        <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>loginUser<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. æ”¾è¡Œ</span>
        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æµ‹è¯•-redisåºåˆ—åŒ–æŠ¥é”™-å°šæœªè§£å†³" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•-redisåºåˆ—åŒ–æŠ¥é”™-å°šæœªè§£å†³" aria-hidden="true">#</a> æµ‹è¯•ï¼šredisåºåˆ—åŒ–æŠ¥é”™ï¼Œå°šæœªè§£å†³</h3><h2 id="è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨" aria-hidden="true">#</a> è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨</h2><p>æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨è®¤è¯å¤±è´¥æˆ–è€…æ˜¯æˆæƒå¤±è´¥çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å’Œæˆ‘ä»¬çš„æ¥å£ä¸€æ ·è¿”å›ç›¸åŒç»“æ„çš„JSON,è¿™æ ·å¯ä»¥è®©å‰ç«¯èƒ½å¯¹å“åº”è¿›è¡Œç»Ÿä¸€çš„å¤„ ç†ã€‚è¦å®ç°è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬éœ€è¦çŸ¥é“SpringSecurityçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚ åœ¨SpringSecurityä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è®¤è¯æˆ–è€…æˆæƒçš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ä¼šè¢«ExceptionTranslationFilteræ•è·åˆ°ã€‚åœ¨ ExceptionTranslationFilterä¸­ä¼šå»åˆ¤æ–­æ˜¯è®¤è¯å¤±è´¥è¿˜æ˜¯æˆæƒå¤±è´¥å‡ºç°çš„å¼‚å¸¸ã€‚ å¦‚æœæ˜¯è®¤è¯è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAuthenticationException:ç„¶åè°ƒç”¨AuthenticationEntryPointå¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ ç†ã€‚ å¦‚æœæ˜¯æˆæƒè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAccessDeniedExceptionç„¶åè°ƒç”¨AccessDeniedHandlerå¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚ æ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰AuthenticationEntryPointiå’ŒAccessDeniedHandlerç„¶åé…ç½®ç»™SpringSecurity å³å¯ã€‚</p><p><a href="https://juejin.cn/post/7142764132213719047" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/7142764132213719047<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>AuthenticationEntryPointImpl</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationEntryPointImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationEntryPoint</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commence</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">AuthenticationException</span>
            authException<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span><span class="token punctuation">{</span>

        <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result<span class="token operator">=</span><span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;æ‚¨çš„æƒé™ä¸è¶³&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¤„ç†å¼‚å¸¸</span>
        <span class="token class-name">WebUtil</span><span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AccessDeniedHandlerImpl</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccessDeniedHandlerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccessDeniedHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                       <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                       <span class="token class-name">AccessDeniedException</span> accessDeniedException<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result<span class="token operator">=</span><span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;æ‚¨çš„æƒé™ä¸è¶³&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¤„ç†å¼‚å¸¸</span>
        <span class="token class-name">WebUtil</span><span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>WebUtil</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebUtil</span> <span class="token punctuation">{</span>

    <span class="token comment">//å°†å­—ç¬¦ä¸²æ¸²æŸ“åˆ°å®¢æˆ·ç«¯</span>
    <span class="token comment">//</span>
    <span class="token comment">//@param responseæ¸²æŸ“å¯¹è±¡</span>
    <span class="token comment">//@param stringå¾…æ¸²æŸ“çš„å­—ç¬¦ä¸²</span>
    <span class="token comment">//@return nul1</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">renderstring</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">renderString</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SecurityConfig</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationEntryPointImpl</span> authenticationEntryPoint<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccessDeniedHandlerImpl</span> accessDeniedHandler<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http
                <span class="token comment">// å…³é—­ csrf</span>
                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¸é€šè¿‡sessionè·å–SecurityContext</span>
                <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/loginByPhone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token comment">// é™¤äº†ä¸Šé¢çš„è¯·æ±‚ï¼Œä»»ä½•è¯·æ±‚éƒ½éœ€è¦é‰´æƒè®¤è¯</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ·»åŠ è¿‡æ»¤å™¨</span>
        http<span class="token punctuation">.</span><span class="token function">addFilterBefore</span><span class="token punctuation">(</span>jwtAuthenticationTokenFilter<span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// é…ç½®å¼‚å¸¸å¤„ç†å™¨</span>
        http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span>authenticationEntryPoint<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">accessDeniedHandler</span><span class="token punctuation">(</span>accessDeniedHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è·¨åŸŸ" tabindex="-1"><a class="header-anchor" href="#è·¨åŸŸ" aria-hidden="true">#</a> è·¨åŸŸ</h2><p><a href="https://blog.csdn.net/u011738045/article/details/119973754" target="_blank" rel="noopener noreferrer">SpringBoot ä¼˜é›…é…ç½®è·¨åŸŸå¤šç§æ–¹å¼åŠSpring Securityè·¨åŸŸè®¿é—®é…ç½®çš„å‘_springsecurity å…è®¸å¤šåŸŸåè®¿é—®api-CSDNåšå®¢<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="æ‹¦æˆªå™¨æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#æ‹¦æˆªå™¨æ–¹å¼" aria-hidden="true">#</a> æ‹¦æˆªå™¨æ–¹å¼</h3><p>é‡å†™WebMvcConfigurerçš„<code>addCorsMappings</code> æ–¹æ³•</p><p>CorsConfig é…ç½®ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token comment">//é¡¹ç›®ä¸­çš„æ‰€æœ‰æ¥å£éƒ½æ”¯æŒè·¨åŸŸ</span>
                <span class="token punctuation">.</span><span class="token function">allowedOriginPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token comment">//æ‰€æœ‰åœ°å€éƒ½å¯ä»¥è®¿é—®ï¼Œä¹Ÿå¯ä»¥é…ç½®å…·ä½“åœ°å€</span>
                <span class="token punctuation">.</span><span class="token function">allowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token comment">//&quot;GET&quot;, &quot;HEAD&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;</span>
                <span class="token punctuation">.</span><span class="token function">maxAge</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è·¨åŸŸå…è®¸æ—¶é—´</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•" aria-hidden="true">#</a> <strong>è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•</strong></h2><p><a href="https://blog.51cto.com/wangzhenjun/5605871#:~:text=%E5%9F%BA%E4%BA%8ESpring,%E5%8F%82%E8%80%83%E8%8B%A5%E4%BE%9D%E7%9A%84%E6%B3%A8%E8%A7%A3%EF%BC%81" target="_blank" rel="noopener noreferrer">https://blog.51cto.com/wangzhenjun/5605871#:~:text=åŸºäºSpring,å‚è€ƒè‹¥ä¾çš„æ³¨è§£ï¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="è‡ªå®šä¹‰è®¤è¯æˆåŠŸå¤„ç†å™¨" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰è®¤è¯æˆåŠŸå¤„ç†å™¨" aria-hidden="true">#</a> è‡ªå®šä¹‰è®¤è¯æˆåŠŸå¤„ç†å™¨</h2><p><a href="https://blog.csdn.net/zhongjianboy/article/details/123646433" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/zhongjianboy/article/details/123646433<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨-1" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨-1" aria-hidden="true">#</a> è‡ªå®šä¹‰è®¤è¯å¤±è´¥å¤„ç†å™¨</h2><p><a href="https://blog.csdn.net/zhongjianboy/article/details/123648334" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/zhongjianboy/article/details/123648334<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="æ³¨é”€æˆåŠŸå¤„ç†å™¨" tabindex="-1"><a class="header-anchor" href="#æ³¨é”€æˆåŠŸå¤„ç†å™¨" aria-hidden="true">#</a> <strong>æ³¨é”€æˆåŠŸå¤„ç†å™¨</strong></h2><p><a href="https://www.cnblogs.com/yu3304/p/17357048.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/yu3304/p/17357048.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="oauth2-0" tabindex="-1"><a class="header-anchor" href="#oauth2-0" aria-hidden="true">#</a> OAuth2.0</h2><p><a href="https://www.bilibili.com/video/BV1dN4y1Z7zd/?spm_id_from=333.1007.tianma.5-3-17.click&amp;vd_source=f25f5a8d75a3a60d5a288f726803ec11" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1dN4y1Z7zd/?spm_id_from=333.1007.tianma.5-3-17.click&amp;vd_source=f25f5a8d75a3a60d5a288f726803ec11<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>OAuth 2.0å¼€æ”¾æˆæƒå®ç°å¾®ä¿¡æ‰«ç ç™»å½•ç¬¬ä¸‰æ–¹å¹³å° é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1Ao3HMlI90pvmuhzZf-BzLQ?pwd=q7rl" target="_blank" rel="noopener noreferrer">https://pan.baidu.com/s/1Ao3HMlI90pvmuhzZf-BzLQ?pwd=q7rl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://zhuanlan.zhihu.com/p/89020647" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/89020647<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener noreferrer">https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>OAuth(Open Authorization)æ˜¯ä¸€ä¸ªå…³äºæˆæƒï¼ˆauthorization)çš„å¼€æ”¾ç½‘ç»œæ ‡å‡†ï¼Œå…è®¸ç”¨æˆ·æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®ä»–ä»¬å­˜å‚¨åœ¨å¦å¤–çš„æœåŠ¡æä¾›è€…ä¸Šçš„ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å°†ç”¨æˆ·åå’Œå¯†ç æä¾›ç»™ç¬¬ä¸‰æ–¹ã€‚ OAuthåœ¨å…¨ä¸–ç•Œå¾—åˆ°å¹¿æ³›åº”ç”¨ï¼Œç›®å‰çš„ç‰ˆæœ¬æ˜¯2.0ç‰ˆã€‚</p><p>åè®®ç‰¹ç‚¹ï¼š ç­’å•ï¼šä¸ç®¡æ˜¯OAuthæœåŠ¡æä¾›è€…è¿˜æ˜¯åº”ç”¨å¼€å‘è€…ï¼Œéƒ½å¾ˆæ˜“äºç†è§£ä¸ä½¿ç”¨ï¼› å®‰å…¨ï¼šæ²¡æœ‰æ¶‰åŠåˆ°ç”¨æˆ·å¯†é’¥ç­‰ä¿¡æ¯ï¼Œæ›´å®‰å…¨æ›´çµæ´»ï¼› å¼€æ”¾ï¼šä»»ä½•æœåŠ¡æä¾›å•†éƒ½å¯ä»¥å®ç°OAuth,ä»»ä½•è½¯ä»¶å¼€å‘å•†éƒ½å¯ä»¥ä½¿ç”¨OAuth</p><p>ç”¨å¤„ï¼šç¬¬ä¸‰æ–¹å¹³å°ç™»å½•</p><h3 id="è§’è‰²-åº”ç”¨ã€apiå’Œç”¨æˆ·" tabindex="-1"><a class="header-anchor" href="#è§’è‰²-åº”ç”¨ã€apiå’Œç”¨æˆ·" aria-hidden="true">#</a> è§’è‰²ï¼šåº”ç”¨ã€apiå’Œç”¨æˆ·</h3><ul><li>oAuthçš„å®¢æˆ·ã€‚oAuthçš„â€œå®¢æˆ·â€æ˜¯é‚£äº›å°è¯•è®¿é—®ç”¨æˆ·è´¦æˆ·ä¿¡æ¯çš„åº”ç”¨ç¨‹åºï¼Œè€Œè¿™ä¸ªè®¿é—®æ“ä½œéœ€è¦å¾—åˆ°ç”¨æˆ·çš„åŒæ„æ‰èƒ½å®Œæˆã€‚</li><li>èµ„æºæœåŠ¡å™¨ï¼ˆResource Serverï¼Œä¹Ÿå«åšapi serverï¼‰ã€‚èµ„æºæœåŠ¡å™¨æä¾›äº†è®¿é—®ç”¨æˆ·ä¿¡æ¯çš„apiæ¥å£ã€‚</li><li>æˆæƒæœåŠ¡å™¨ï¼ˆè®¤è¯æœåŠ¡å™¨ï¼‰ï¼ˆAuthorization Serverï¼‰ï¼šæˆæƒæœåŠ¡å™¨æä¾›äº†æ¥å£æ¥è®©ç”¨æˆ·å†³å®šåŒæ„æˆ–è€…æ‹’ç»å½“å‰è®¿é—®è¯·æ±‚ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒAuthorization Serverå’ŒResource Serveræ˜¯åˆåœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œçš„ï¼Œè™½ç„¶oAuth2.0å…è®¸å®ƒä»¬ç‹¬ç«‹å¼€ï¼Œç”šè‡³ç”¨ä¸åŒçš„åŸŸåã€‚</li><li>ç”¨æˆ·ï¼šç”¨æˆ·æ˜¯ä»–ä»¬è‡ªèº«è´¦æˆ·ä¿¡æ¯çš„æ‹¥æœ‰è€…ï¼Œå¯¹æœ¬æ¬¡è®¿é—®è¯·æ±‚æœ‰å†³å®šæƒã€‚</li></ul><h3 id="å››ç§æˆæƒæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å››ç§æˆæƒæ¨¡å¼" aria-hidden="true">#</a> å››ç§æˆæƒæ¨¡å¼</h3><p>æˆæƒç æ¨¡å¼(Authorization Code Grant) ç›®å‰æœ€å®‰å…¨æœ€å¤æ‚ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æˆæƒæµç¨‹ éšå¼æˆæƒæ¨¡å¼(Implicit Grant) ç”¨æˆ·åå¯†ç æ¨¡å¼(Resource Owner Password Credentials Grant) å®¢æˆ·ç«¯æ¨¡å¼(Client Credentials Grant)</p><h3 id="ç†è®ºåŸºç¡€-javaç”ŸæˆäºŒç»´ç " tabindex="-1"><a class="header-anchor" href="#ç†è®ºåŸºç¡€-javaç”ŸæˆäºŒç»´ç " aria-hidden="true">#</a> ç†è®ºåŸºç¡€-javaç”ŸæˆäºŒç»´ç </h3><p>Hutoolæ˜¯ä¸€ä¸ªJaVaå·¥å…·åŒ…ç±»åº“ï¼Œå¯¹æ–‡ä»¶ã€æµã€åŠ å¯†è§£å¯†ã€è½¬ç ã€æ­£åˆ™ã€çº¿ç¨‹ã€XMLç­‰DKæ–¹æ³•è¿›è¡Œå°è£…ï¼Œç»„æˆå„ç§Utilå·¥å…·ç±»ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
    &lt;version&gt;5.8.16&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”ŸæˆäºŒç»´ç <a href="https://www.hutool.cn/docs/#/extra/%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%B7%A5%E5%85%B7-QrCodeUtil?id=%e4%bd%bf%e7%94%a8" target="_blank" rel="noopener noreferrer">https://www.hutool.cn/docs/#/extra/äºŒç»´ç å·¥å…·-QrCodeUtil?id=ä½¿ç”¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ç”ŸæˆäºŒç»´ç è¿˜éœ€è¦å¼•å…¥ <a href="https://www.hutool.cn/docs/#/extra/%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%B7%A5%E5%85%B7-QrCodeUtil?id=%E5%BC%95%E5%85%A5zxing" target="_blank" rel="noopener noreferrer">zxing<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ï¼ˆè€ƒè™‘åˆ°Hutoolçš„éå¼ºåˆ¶ä¾èµ–æ€§ï¼Œå› æ­¤zxingéœ€è¦ç”¨æˆ·è‡ªè¡Œå¼•å…¥ï¼‰</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.google.zxing&lt;/groupId&gt;
    &lt;artifactId&gt;core&lt;/artifactId&gt;
    &lt;version&gt;3.3.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// ç”ŸæˆæŒ‡å®šurlå¯¹åº”çš„äºŒç»´ç åˆ°æ–‡ä»¶ï¼Œå®½å’Œé«˜éƒ½æ˜¯300åƒç´  ï¼Œç”Ÿæˆä½ç½®æ˜¯ d:/qrcode.jpg
QrCodeUtil.generate(&quot;https://hutool.cn/&quot;, 300, 300, FileUtil.file(&quot;d:/qrcode.jpg&quot;));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¾®ä¿¡æ‰«ç ç™»å½•" tabindex="-1"><a class="header-anchor" href="#å¾®ä¿¡æ‰«ç ç™»å½•" aria-hidden="true">#</a> å¾®ä¿¡æ‰«ç ç™»å½•</h3><p><a href="https://cloud.tencent.com/developer/article/1985478" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/1985478<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æµç¨‹è¯¦ç»†</p><p><a href="https://cloud.tencent.com/developer/article/2245870?areaId=106001" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/2245870?areaId=106001<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://cloud.tencent.com/developer/article/2225357?areaId=106001" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/2225357?areaId=106001<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="/blog/202310290546382.png" alt="image-20231029054644147" loading="lazy"></p><h4 id="æµ‹è¯•è´¦å·ç”³è¯·ä½¿ç”¨-cpolar-å†…ç½‘ç©¿é€" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•è´¦å·ç”³è¯·ä½¿ç”¨-cpolar-å†…ç½‘ç©¿é€" aria-hidden="true">#</a> æµ‹è¯•è´¦å·ç”³è¯·ä½¿ç”¨ cpolarï¼ˆå†…ç½‘ç©¿é€ï¼‰</h4><p><a href="https://www.cpolar.com/" target="_blank" rel="noopener noreferrer">https://www.cpolar.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä½¿ç”¨cpolarç”Ÿæˆçš„<strong>å…¬ç½‘åœ°å€</strong>ç”³è¯·æµ‹è¯•è´¦å·</p><p><img src="/blog/202310290619504.png" alt="image-20231029061904426" loading="lazy"></p><p>æ¥å£é…ç½®ä¿¡æ¯ä¼šå‘å¡«å†™çš„urlå‘é€å†…å®¹ï¼Œè¿™é‡Œä½¿ç”¨ WeChatController é‡Œçš„æ–¹æ³•æ¥æ”¶</p><p>WeChatController</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@RestController
public class WeChatController {
    @RequestMapping(&quot;/wechat&quot;)
    public String WxSignatureCheck(
            @RequestParam(value =&quot;signature&quot;)String signature,
            @RequestParam(value= &quot;timestamp&quot;)String timestamp,
            @RequestParam(value= &quot;nonce&quot;)String nonce,
            @RequestParam(value= &quot;echostr&quot;)String echostr
    ){
        System.out.println(&quot;æ”¶åˆ°å¾®ä¿¡æ ¡éªŒè¯·æ±‚ï¼Œechostr:{}&quot;+echostr);
        //TODO æ ¡éªŒæ˜¯å¦å¾®ä¿¡çš„è¯·æ±‚
        return echostr;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æç¤ºé…ç½®æˆåŠŸåˆ™æˆåŠŸäº†</p><p>åœ¨ä¸‹å›¾ä½ç½®é…ç½®ä¸ŠåŸŸå 48112c0.r17.cpolar.top</p><p><img src="/blog/202310290622873.png" alt="image-20231029062239785" loading="lazy"></p><p>å¾®ä¿¡ç½‘é¡µæˆæƒæµç¨‹å‚è€ƒå®˜ç½‘ï¼š</p><p><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html" target="_blank" rel="noopener noreferrer">https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ç½‘é¡µæˆæƒæµç¨‹åˆ†ä¸ºå››æ­¥ï¼š</p><ol><li>å¼•å¯¼ç”¨æˆ·è¿›å…¥æˆæƒé¡µé¢åŒæ„æˆæƒï¼Œè·å–code</li><li>é€šè¿‡codeæ¢å–ç½‘é¡µæˆæƒaccess_tokenï¼ˆä¸åŸºç¡€æ”¯æŒä¸­çš„access_tokenä¸åŒï¼‰</li><li>å¦‚æœéœ€è¦ï¼Œå¼€å‘è€…å¯ä»¥åˆ·æ–°ç½‘é¡µæˆæƒaccess_tokenï¼Œé¿å…è¿‡æœŸ</li><li>é€šè¿‡ç½‘é¡µæˆæƒaccess_tokenå’Œopenidè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆæ”¯æŒUnionIDæœºåˆ¶ï¼‰</li></ol><p>ç¬¬ä¸€æ­¥æµç¨‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/wxLogin&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">wxLoginPage</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//redirect_Urlæ˜¯å›è°ƒçš„åœ°å€  æ³¨æ„è¦è½¬æˆ UrlEncode æ ¼å¼</span>
        <span class="token class-name">String</span> redirectUrl<span class="token operator">=</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;http://48112c0.r17.cpolar.top/wxCallback&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ„é€äºŒæ¨ç é“¾æ¥åœ°å€(appid æ¢æˆè‡ªå·±çš„)</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span><span class="token string">&quot;https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxcc4117be0cfcbc3f&amp;redirect_uri=&quot;</span>
                <span class="token operator">+</span>redirectUrl<span class="token operator">+</span><span class="token string">&quot;&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=STATE#wechat_redirect&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//ç”ŸæˆäºŒç»´ç çš„ï¼Œæ‰«æåè·³è½¬ä¸Šé¢çš„åœ°å€</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;image/png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">QrCodeUtil</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span><span class="token string">&quot;jpg&quot;</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äºŒéƒ¨æµç¨‹</p><p>TokenInfo</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TokenInfo</span> <span class="token punctuation">{</span>
     <span class="token comment">//&quot;access_token&quot;:&quot;ACCESS_TOKEN&quot;,</span>
     <span class="token comment">//&quot;expires_in&quot;:7200,</span>
     <span class="token comment">//&quot;refresh_token&quot;:&quot;REFRESH_TOKEN&quot;,</span>
     <span class="token comment">//&quot;openid&quot;:&quot;OPENID&quot;,</span>
     <span class="token comment">//&quot;scope&quot;:&quot;SCOPE&quot;,</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> accessToken<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> expiresIn<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> refreshToken<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> openid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> scope<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/posts/banana/java/security.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">Last update: </span><!----></div><div class="meta-item contributors"><span class="label">Contributors: </span><!--[--><!--[--><span class="contributor" title="email: 3180806542@qq.com">ä¸œæ–¹å‡æ´›</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/blog/posts/banana/java/shiro.html" class="nav-link prev" aria-label="shiro"><div class="hint"><span class="arrow left"></span>Prev</div><div class="link"><!---->shiro</div></a><a href="/blog/posts/banana/java/1.html" class="nav-link next" aria-label="spring cloud"><div class="hint">Next<span class="arrow right"></span></div><div class="link">spring cloud<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Default footer</div><div class="copyright">Copyright Â© 2023 å¸†</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/blog/assets/app.a6537d53.js" defer></script>
  </body>
</html>
